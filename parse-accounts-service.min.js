/**
 * themeans-core - 
 * @version v0.1.0 - 2015-04-06
 * @link 
 * @license 
 */
"use strict";angular.module("tm.parseAccounts",["tm.parse","tm.localstorage"]).factory("Settings",["Parse",function(a){return a.Object.extend("Settings")}]).provider("tmAccounts",function(){var a={settingsCacheKey:"User/Settings",settingEditCacheKey:"User/Settings/Edit",rolesCacheKey:"User/Roles",isSecured:!1};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","$timeout","Settings","Parse","tmLocalStorage","$log",function(b,c,d,e,f,g){function h(c){var d,h=b.defer(),i=new e.Query(e.Role),j=a.rolesCacheKey;return c.fetch().then(function(){i.equalTo("users",c),i.find().then(function(a){d=a.map(function(a){return a.get("name")}),f.setObject(j,d),d=f.getObject(j,[]),h.resolve(d)},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()})},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()}),h.promise}function i(c){var d=b.defer(),h=a.rolesCacheKey,i=c.id||c.objectId;return"undefined"==typeof i?(g.error("User has no id or objectId: cannot get users roles."),d.reject({message:"Please try logging in again, or contact system admin."})):(e.Cloud.run("getUserRoles",{userId:i},{success:function(a){f.setObject(h,a),a=f.getObject(h,[]),d.resolve(a)},error:function(a){g.error("Parse Cloud getUserRoles Error: "+a.message),d.reject()}}),d.promise)}function j(h,i){var j,k=b.defer(),l=new e.Query(d),m=a.settingsCacheKey;return i&&(m=a.settingsEditCacheKey),c(function(){var a=f.getObject(m);k.notify(a)},0),l.get(h,{success:function(a){var b=a.getNgModel();i&&(b=a.getNgFormModel()),f.setObject(m,b),j=f.getObject(m),k.resolve(j)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),k.reject({message:"Please try again in a few moments, or contact support."})}}),k.promise}return this.getUserRoles=function(b){return a.isSecured===!0?i(b):h(b)},this.isUserInRole=function(b){var c=f.getObject(a.rolesCacheKey,[]);return c.indexOf(b)>=0?!0:!1},this.getSettingsByIdForEditing=function(a){return j(a,!0)},this.getSettingsByIdForDisplay=function(a){return j(a,!1)},this.updateSettings=function(c){var e=b.defer(),h=new d(c,{ngModel:!0,resetOpsQueue:!1}),i=a.settingsEditCacheKey;return h.save(null,{success:function(a){f.setObject(i,a),a=f.getObject(i),e.resolve(a)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this}],this}),angular.module("tm.parseAccounts",["tm.parse","tm.localstorage"]).factory("Settings",["Parse",function(a){return a.Object.extend("Settings")}]).provider("tmAccounts",function(){var a={settingsCacheKey:"User/Settings",settingEditCacheKey:"User/Settings/Edit",rolesCacheKey:"User/Roles",isSecured:!1};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","$timeout","Settings","Parse","tmLocalStorage","$log",function(b,c,d,e,f,g){function h(c){var d,h=b.defer(),i=new e.Query(e.Role),j=a.rolesCacheKey;return c.fetch().then(function(){i.equalTo("users",c),i.find().then(function(a){d=a.map(function(a){return a.get("name")}),f.setObject(j,d),d=f.getObject(j,[]),h.resolve(d)},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()})},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()}),h.promise}function i(c){var d=b.defer(),h=a.rolesCacheKey,i=c.id||c.objectId;return"undefined"==typeof i?(g.error("User has no id or objectId: cannot get users roles."),d.reject({message:"Please try logging in again, or contact system admin."})):(e.Cloud.run("getUserRoles",{userId:i},{success:function(a){f.setObject(h,a),a=f.getObject(h,[]),d.resolve(a)},error:function(a){g.error("Parse Cloud getUserRoles Error: "+a.message),d.reject()}}),d.promise)}function j(h,i){var j,k=b.defer(),l=new e.Query(d),m=a.settingsCacheKey;return i&&(m=a.settingsEditCacheKey),c(function(){var a=f.getObject(m);k.notify(a)},0),l.get(h,{success:function(a){var b=a.getNgModel();i&&(b=a.getNgFormModel()),f.setObject(m,b),j=f.getObject(m),k.resolve(j)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),k.reject({message:"Please try again in a few moments, or contact support."})}}),k.promise}return this.getUserRoles=function(b){return a.isSecured===!0?i(b):h(b)},this.isUserInRole=function(b){var c=f.getObject(a.rolesCacheKey,[]);return c.indexOf(b)>=0?!0:!1},this.getSettingsByIdForEditing=function(a){return j(a,!0)},this.getSettingsByIdForDisplay=function(a){return j(a,!1)},this.updateSettings=function(c){var e=b.defer(),h=new d(c,{ngModel:!0,resetOpsQueue:!1}),i=a.settingsEditCacheKey;return h.save(null,{success:function(a){f.setObject(i,a),a=f.getObject(i),e.resolve(a)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this}],this}),angular.module("tm.parseAccounts",["tm.parse","tm.localstorage"]).factory("Settings",["Parse",function(a){return a.Object.extend("Settings")}]).provider("tmAccounts",function(){var a={settingsCacheKey:"User/Settings",settingEditCacheKey:"User/Settings/Edit",rolesCacheKey:"User/Roles",isSecured:!1};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","$timeout","Settings","Parse","tmLocalStorage","$log",function(b,c,d,e,f,g){function h(c){var d,h=b.defer(),i=new e.Query(e.Role),j=a.rolesCacheKey;return c.fetch().then(function(){i.equalTo("users",c),i.find().then(function(a){d=a.map(function(a){return a.get("name")}),f.setObject(j,d),d=f.getObject(j,[]),h.resolve(d)},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()})},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()}),h.promise}function i(c){var d=b.defer(),h=a.rolesCacheKey,i=c.id||c.objectId;return"undefined"==typeof i?(g.error("User has no id or objectId: cannot get users roles."),d.reject({message:"Please try logging in again, or contact system admin."})):(e.Cloud.run("getUserRoles",{userId:i},{success:function(a){f.setObject(h,a),a=f.getObject(h,[]),d.resolve(a)},error:function(a){g.error("Parse Cloud getUserRoles Error: "+a.message),d.reject()}}),d.promise)}function j(h,i){var j,k=b.defer(),l=new e.Query(d),m=a.settingsCacheKey;return i&&(m=a.settingsEditCacheKey),c(function(){var a=f.getObject(m);k.notify(a)},0),l.get(h,{success:function(a){var b=a.getNgModel();i&&(b=a.getNgFormModel()),f.setObject(m,b),j=f.getObject(m),k.resolve(j)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),k.reject({message:"Please try again in a few moments, or contact support."})}}),k.promise}return this.getUserRoles=function(b){return a.isSecured===!0?i(b):h(b)},this.isUserInRole=function(b){var c=f.getObject(a.rolesCacheKey,[]);return c.indexOf(b)>=0?!0:!1},this.getSettingsByIdForEditing=function(a){return j(a,!0)},this.getSettingsByIdForDisplay=function(a){return j(a,!1)},this.updateSettings=function(c){var e=b.defer(),h=new d(c,{ngModel:!0,resetOpsQueue:!1}),i=a.settingsEditCacheKey;return h.save(null,{success:function(a){f.setObject(i,a),a=f.getObject(i),e.resolve(a)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this}],this}),angular.module("tm.parseAccounts",["tm.parse","tm.localstorage"]).factory("Settings",["Parse",function(a){return a.Object.extend("Settings")}]).provider("tmAccounts",function(){var a={settingsCacheKey:"User/Settings",settingEditCacheKey:"User/Settings/Edit",rolesCacheKey:"User/Roles",isSecured:!1};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","$timeout","Settings","Parse","tmLocalStorage","$log",function(b,c,d,e,f,g){function h(c){var d,h=b.defer(),i=new e.Query(e.Role),j=a.rolesCacheKey;return c.fetch().then(function(){i.equalTo("users",c),i.find().then(function(a){d=a.map(function(a){return a.get("name")}),f.setObject(j,d),d=f.getObject(j,[]),h.resolve(d)},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()})},function(a){g.error("Parse Error: "+a.message,a.code),h.reject()}),h.promise}function i(c){var d=b.defer(),h=a.rolesCacheKey,i=c.id||c.objectId;return"undefined"==typeof i?(g.error("User has no id or objectId: cannot get users roles."),d.reject({message:"Please try logging in again, or contact system admin."})):(e.Cloud.run("getUserRoles",{userId:i},{success:function(a){f.setObject(h,a),a=f.getObject(h,[]),d.resolve(a)},error:function(a){g.error("Parse Cloud getUserRoles Error: "+a.message),d.reject()}}),d.promise)}function j(h,i){var j,k=b.defer(),l=new e.Query(d),m=a.settingsCacheKey;return i&&(m=a.settingsEditCacheKey),c(function(){var a=f.getObject(m);k.notify(a)},0),l.get(h,{success:function(a){var b=a.getNgModel();i&&(b=a.getNgFormModel()),f.setObject(m,b),j=f.getObject(m),k.resolve(j)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),k.reject({message:"Please try again in a few moments, or contact support."})}}),k.promise}return this.getUserRoles=function(b){return a.isSecured===!0?i(b):h(b)},this.isUserInRole=function(b){var c=f.getObject(a.rolesCacheKey,[]);return c.indexOf(b)>=0?!0:!1},this.getSettingsByIdForEditing=function(a){return j(a,!0)},this.getSettingsByIdForDisplay=function(a){return j(a,!1)},this.updateSettings=function(c){var e=b.defer(),h=new d(c,{ngModel:!0,resetOpsQueue:!1}),i=a.settingsEditCacheKey;return h.save(null,{success:function(a){f.setObject(i,a),a=f.getObject(i),e.resolve(a)},error:function(a,b){g.error("Parse Error: "+b.message,b.code),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this}],this});