/**
 * utils-demo - 
 * @version v0.0.2 - 2015-03-12
 * @link 
 * @license 
 */
"use strict";angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","CACHEKEYS",function(a,b,c,d,e,f,g,h){function i(c,g){var i,j,k,l=a.defer(),m=new d.Query(b),n=h.profile+c;return g&&(n=h["profile:edit"]+c),f(function(){k=e.getObject(n),l.notify(k)},0),m.get(c,{success:function(a){j=a.getNgModel(),g&&(j=a.getNgFormModel()),e.setObject(n,j),i=e.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1}),g=h["profile:edit"]+f.id;return f.save(null,{success:function(a){e.setObject(g,a.getNgFormModel()),a=e.getObject(g),d.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),d.reject({message:"Please try again in a few moments, or contact support."})}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void e.reject({message:"Please contact support"});for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(b){var c,g=a.defer(),i=d.User.current()||{},j=new d.Query(d.Role),k=h.candidates;return f(function(){c=e.getObject(k,[]),g.notify(c)},0),j.equalTo("name",b),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void g.reject({message:"Something went wrong, please contact system admin."});var c=a[0].relation(b+"s"),d=c.query();i.id&&d.notEqualTo(b,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));e.setObject(k,b),b=e.getObject(k,[]),g.resolve(b)},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","CACHEKEYS",function(a,b,c,d,e,f,g,h){function i(c,g){var i,j,k,l=a.defer(),m=new d.Query(b),n=h.profile+c;return g&&(n=h["profile:edit"]+c),f(function(){k=e.getObject(n),l.notify(k)},0),m.get(c,{success:function(a){j=a.getNgModel(),g&&(j=a.getNgFormModel()),e.setObject(n,j),i=e.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(h["profile:edit"]+a.id,a.getNgFormModel()),a=e.getObject(h["profile:edit"]+a.id),d.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),d.reject({message:"Please try again in a few moments, or contact support."})}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void e.reject({message:"Please contact support"});for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(b){var c,g=a.defer(),i=d.User.current()||{},j=new d.Query(d.Role);return f(function(){c=e.getObject(h.candidates,[]),g.notify(c)},0),j.equalTo("name",b),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void g.reject({message:"Something went wrong, please contact system admin."});var c=a[0].relation(b+"s"),d=c.query();i.id&&d.notEqualTo(b,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));e.setObject(h.candidates,b),b=e.getObject(h.candidates,[]),g.resolve(b)},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){console.error("Parse Error: ",b),i.reject({message:"Please try again in a few moments, or contact support."})}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject("profile:edit"+a.id,a.getNgFormModel()),a=e.getObject("profile:edit"+a.id),d.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),d.reject({message:"Please try again in a few moments, or contact support."})}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void e.reject({message:"Please contact support"});for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(b,c){var g=a.defer(),h=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles",[]);g.notify(a)},0),h.equalTo("name",c),h.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void g.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation(c+"s"),f=d.query();f.notEqualTo(c,b),f.include("profile"),f.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles",[]),g.resolve(b)},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){console.error("Parse Error: ",b),i.reject({message:"Please try again in a few moments, or contact support."})}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject("profile:edit"+a.id,a.getNgFormModel()),a=e.getObject("profile:edit"+a.id),d.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),d.reject({message:"Please try again in a few moments, or contact support."})}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void e.reject({message:"Please contact support"});for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(b,c){var g=a.defer(),h=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles",[]);g.notify(a)},0),h.equalTo("name",c),h.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void g.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation(c),f=d.query();f.notEqualTo(c,b),f.include("profile"),f.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles",[]),g.resolve(b)},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){console.error("Parse Error: ",b),i.reject({message:"Please try again in a few moments, or contact support."})}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject("profile:edit"+a.id,a.getNgFormModel()),a=e.getObject("profile:edit"+a.id),d.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),d.reject({message:"Please try again in a few moments, or contact support."})}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void e.reject({message:"Please contact support"});for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles",[]);c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles",[]),c.resolve(b)},function(a){console.error("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){console.error("Parse Error: ",b),i.reject({message:"Please try again in a few moments, or contact support."})}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject("profile:"+a.id,a),a=e.getObject("profile:"+a.id),d.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),d.reject({message:"Please try again in a few moments, or contact support."})}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles",[]);c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles",[]),c.resolve(b)},function(a){console.error("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){console.error("Parse Error: ",b.code,b.message),i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject("profile:"+a.id,a),a=e.getObject("profile:"+a.id),d.resolve(a)},error:function(a,b){console.error("Parse Error: ",b.code,b.message),d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){console.error("Parse Error: ",a.code,a.message),h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b.code,b.message),e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){console.error("Parse Error: ",b.code,b.message),e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a.code,a.message),f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles",[]);c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles",[]),c.resolve(b)},function(a){console.error("Parse Error: ",a.code,a.message),c.reject(a)})},function(a){console.error("Parse Error: ",a.code,a.message),c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");
for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(b,e){var f=a.defer(),h=new c,i=new d.ACL,j=e.get("profile"),k=g.createHash([b.id,j.id].sort().join(""));return h.set("follower",j),h.set("following",b),h.set("profileIdsHash",k),i.setPublicReadAccess(!0),i.setWriteAccess(e,!0),h.setACL(i),h.save().then(function(){f.resolve()},function(a,b){f.reject(b)}),f.promise},this.unfollowProfile=function(b){var e,f=a.defer(),h=new d.Query(c);return e=e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){f.reject(b)}})}if(!a.length)return f.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&f.resolve()},error:function(a,b){f.reject(b)}}),f.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]);