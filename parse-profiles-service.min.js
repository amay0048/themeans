/**
 * utils-demo - 
 * @version v0.0.2 - 2015-03-19
 * @link 
 * @license 
 */
"use strict";angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(a){var b=a.getNgModel();d.resolve(b)},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation("users"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation("users"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation("users"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())
},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection","tmAccounts","$log",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c){var d=b.defer(),g=new e.Query(i),h=a.connectionsCacheKey;return c&&(h=a.connectionsEditCacheKey),g.include("receiver"),g.include("sender"),g.find({success:function(a){for(var b=[],g={},i=0;i<a.length;i++)c?b.push(a[i].getNgFormModel()):(g=a[i].getNgModel(),g.connection=g.sender,g.sender.user.objectId===e.User.current().id&&(g.connection=g.receiver),delete g.receiver,delete g.sender,"pending"===g.requestStatus&&delete g.connection.objectId,b.push(g));f.setObject(h,b),b=f.getObject(h,[]),d.resolve(b)},error:function(a){k.info("Parse Error: ",a),d.reject({message:"Something went wrong, please contact system admin."})}}),d.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return e.User.current()&&j.isUserInRole("user")?(f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise):d.reject({message:"You are not permitted to perform this action."})},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(){return m(!1)},this.getConnectionsForEdit=function(){return m(!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","$log","md5","Connection","tmAccounts",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c,d){var g=b.defer(),h=new e.Query(i),j=a.connectionsCacheKey;return d&&(j=a.connectionsEditCacheKey),h.include("receiver"),h.include("sender"),h.find({success:function(a){for(var b,c=[],e=0;e<a.length;e++)c.push(d?a[e].getNgFormModel():a[e].getNgModel());f.setObject(j,c),b=f.getObject(j,[]),g.resolve(b)},error:function(a){k.info("Parse Error: ",a),g.reject({message:"Something went wrong, please contact system admin."})}}),g.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));
return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(a){return m(a,!1)},this.getConnectionsForEdit=function(a){return m(a,!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","$log","md5","Connection","tmAccounts",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c,d){var g=b.defer(),h=new e.Query(i),j=a.connectionsCacheKey;return d&&(j=a.connectionsEditCacheKey),h.include("receiver"),h.include("sender"),h.find({success:function(a){for(var b,c=[],e=0;e<a.length;e++)c.push(d?a[e].getNgFormModel():a[e].getNgModel());f.setObject(j,c),b=f.getObject(j,[]),g.resolve(b)},error:function(a){k.info("Parse Error: ",a),g.reject({message:"Something went wrong, please contact system admin."})}}),g.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(a){return m(a,!1)},this.getConnectionsForEdit=function(a){return m(a,!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","$log","md5","Connection","tmAccounts",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c,d){var g=b.defer(),h=new e.Query(i),j=a.connectionsCacheKey;return d&&(j=a.connectionsEditCacheKey),h.include("receiver"),h.include("sender"),h.find({success:function(a){for(var b,c=[],e=0;e<a.length;e++)c.push(d?a[e].getNgFormModel():a[e].getNgModel());f.setObject(j,c),b=f.getObject(j,[]),g.resolve(b)},error:function(a){k.info("Parse Error: ",a),g.reject({message:"Something went wrong, please contact system admin."})}}),g.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(a){return m(a,!1)},this.getConnectionsForEdit=function(a){return m(a,!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage","tm.parseAccounts"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","$log","md5","Connection","tmAccounts",function(b,c,d,e,f,g,h,i,j,k){function l(d,h){var i,j,l,m=b.defer(),n=new e.Query(c),o=a.profileCacheKey;return h&&(o=a.profileEditCacheKey),g(function(){l=f.getObject(o),m.notify(l)},0),n.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(o,j),i=f.getObject(o),m.resolve(i)},error:function(a,b){k.info("Parse Error: ",b),m.reject({message:"Please try again in a few moments, or contact support."})}}),m.promise}function m(c,d){var g=b.defer(),h=new e.Query(i),j=a.connectionsCacheKey;return d&&(j=a.connectionsEditCacheKey),h.include("receiver"),h.include("sender"),h.find({success:function(a){for(var b,c=[],e=0;e<a.length;e++)c.push(d?a[e].getNgFormModel():a[e].getNgModel());f.setObject(j,c),b=f.getObject(j,[]),g.resolve(b)},error:function(a){k.info("Parse Error: ",a),g.reject({message:"Something went wrong, please contact system admin."})}}),g.promise}return this.getProfileByIdForEditing=function(a){return l(a,!0)},this.getProfileByIdForDisplay=function(a){return l(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){k.info("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,l=f.get("profile"),m=h.createHash([a.id,l.id].sort().join(""));return i.set("follower",l),i.set("following",a),i.set("profileIdsHash",m),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){k.info("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f,g=b.defer();if(!e.User.current())return g.reject({message:"You need to be logged in to connect with a profile."});switch(c){case"Follow":f=d;break;case"Connection":f=i}var j=[a,e.User.current().get("profile").id],l=new e.Query(f),m=h.createHash(j.sort().join(""));return l.equalTo("profileIdsHash",m),l.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return k.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){k.info("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d){var f=b.defer();if(!e.User.current())return f.reject({message:"You need to be logged in to connect with a Profile"});var g=e.User.current().id,l=e.User.current().get("profile"),m=a.user.objectId,n=new c,o=new i,p=new e.ACL,q=h.createHash([l.id,a.objectId].sort().join(""));return n.id=a.objectId,p.setReadAccess(g,!0),p.setWriteAccess(g,!0),p.setReadAccess(m,!0),p.setWriteAccess(m,!0),o.setACL(p),o.set("sender",l),o.set("receiver",n),o.set("profileIdsHash",q),o.set("requestStatus","accepted"),j.isUserInRole(d)&&o.set("requestStatus","pending"),o.save({success:function(a){f.resolve(a.getNgModel())},error:function(a){k.info("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.acceptConnectionRequest=function(a){function c(a){k.info("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise},this.checkIfConnectionExists=function(a){var c=b.defer();if(!e.User.current())return c.resolve({noCurrentUser:!0});var d=new e.Query(i),f=[a,e.User.current().get("profile").id],g=h.createHash(f.sort().join(""));return d.equalTo("profileIdsHash",g),d.find({success:function(a){return a.length?a[0]&&"pending"===a[0].get("requestStatus")?c.resolve("pending"):a[0]&&"accepted"===a[0].get("requestStatus")?c.resolve("accepted"):(k.info("Parse Error",a),void c.reject({message:"Please try again in a few moments, or contact support."})):c.resolve("none")},error:function(a){k.info("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(a){return m(a,!1)},this.getConnectionsForEdit=function(a){return m(a,!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),l=a.profilesCacheKey;return g(function(){d=f.getObject(l,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return k.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(l,b),b=f.getObject(l,[]),h.resolve(b)},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){k.info("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection",function(b,c,d,e,f,g,h,i){function j(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}function k(c,d){var g=b.defer(),h=new e.Query(i),j=a.connectionsCacheKey;return d&&(j=a.connectionsEditCacheKey),h.include("receiver"),h.include("sender"),h.find({success:function(a){for(var b,c=[],e=0;e<a.length;e++)c.push(d?a[e].getNgFormModel():a[e].getNgModel());f.setObject(j,c),b=f.getObject(j,[]),g.resolve(b)},error:function(a){console.error("Parse Error: ",a),g.reject({message:"Something went wrong, please contact system admin."})}}),g.promise}return this.getProfileByIdForEditing=function(a){return j(a,!0)},this.getProfileByIdForDisplay=function(a){return j(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f;switch(c){case"Follow":f=d;break;case"Connection":f=i}var g=b.defer(),j=new e.Query(f),k=h.createHash(a.sort().join(""));return j.equalTo("profileIdsHash",k),j.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){console.error("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d,f){var g=b.defer(),j=d.id,k=d.get("profile"),l=a.user.objectId,m=new c,n=new i,o=new e.ACL,p=h.createHash([k.id,a.objectId].sort().join(""));return m.id=a.objectId,o.setReadAccess(j,!0),o.setWriteAccess(j,!0),o.setReadAccess(l,!0),o.setWriteAccess(l,!0),n.setACL(o),n.set("sender",k),n.set("receiver",m),n.set("profileIdsHash",p),n.set("requestStatus","accepted"),f&&n.set("requestStatus","pending"),n.save({success:function(){g.resolve()},error:function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.acceptConnectionRequest=function(a){function c(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise},this.checkIfConnectionExists=function(a){var c=b.defer(),d=new e.Query(i),f=h.createHash(a.sort().join(""));return d.equalTo("profileIdsHash",f),d.find({success:function(a){return a.length?void c.resolve(!0):c.resolve(!1)},error:function(a){console.error("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(a){return k(a,!1)},this.getConnectionsForEdit=function(a){return k(a,!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection",function(b,c,d,e,f,g,h,i){function j(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}function k(c,d){var g=b.defer(),h=new e.Query(i),j=a.connectionsCacheKey;return d&&(j=a.connectionsEditCacheKey),h.include("receiver"),h.include("sender"),h.find({success:function(a){for(var b,c=[],e=0;e<a.length;e++)c.push(d?a[e].getNgFormModel():a[e].getNgModel());f.setObject(j,c),b=f.getObject(j,[]),g.resolve(b)},error:function(a){console.error("Parse Error: ",a),g.reject({message:"Something went wrong, please contact system admin."})}}),g.promise}return this.getProfileByIdForEditing=function(a){return j(a,!0)},this.getProfileByIdForDisplay=function(a){return j(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})
}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f;switch(c){case"Follow":f=d;break;case"Connection":f=i}var g=b.defer(),j=new e.Query(f),k=h.createHash(a.sort().join(""));return j.equalTo("profileIdsHash",k),j.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){console.error("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d,f){var g=b.defer(),j=d.id,k=d.get("profile"),l=a.user.objectId,m=new c,n=new i,o=new e.ACL,p=h.createHash([k.id,a.objectId].sort().join(""));return m.id=a.objectId,o.setReadAccess(j,!0),o.setWriteAccess(j,!0),o.setReadAccess(l,!0),o.setWriteAccess(l,!0),n.setACL(o),n.set("sender",k),n.set("receiver",m),n.set("profileIdsHash",p),n.set("requestStatus","accepted"),f&&n.set("requestStatus","pending"),n.save({success:function(){g.resolve()},error:function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.acceptConnectionRequest=function(a){function c(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise},this.checkIfConnectionExists=function(a){var c=b.defer(),d=new e.Query(i),f=h.createHash(a.sort().join(""));return d.equalTo("profileIdsHash",f),d.find({success:function(a){return a.length?void c.resolve(!0):c.resolve(!1)},error:function(a){console.error("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(a){return k(a,!1)},this.getConnectionsForEdit=function(a){return k(a,!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).factory("Connection",["Parse",function(a){return a.Object.extend("Connection")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles",connectionsCacheKey:"User/Connections",connectionsEditCacheKey:"User/Connections/Edit"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5","Connection",function(b,c,d,e,f,g,h,i){function j(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}function k(c,d){var g=b.defer(),h=new e.Query(i),j=a.connectionsCacheKey;return d&&(j=a.connectionsEditCacheKey),h.include("receiver"),h.include("sender"),h.find({success:function(a){for(var b,c=[],e=0;e<a.length;e++)c.push(d?a[e].getNgFormModel():a[e].getNgModel());f.setObject(j,c),b=f.getObject(j,[]),g.resolve(b)},error:function(a){console.error("Parse Error: ",a),g.reject({message:"Something went wrong, please contact system admin."})}}),g.promise}return this.getProfileByIdForEditing=function(a){return j(a,!0)},this.getProfileByIdForDisplay=function(a){return j(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.destroyProfileRelation=function(a,c){var f;switch(c){case"Follow":f=d;break;case"Connection":f=i}var g=b.defer(),j=new e.Query(f),k=h.createHash(a.sort().join(""));return j.equalTo("profileIdsHash",k),j.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse "+c+" object found."),void g.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&g.resolve()},error:function(a,b){console.error("Parse Error: ",b),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.connectWithProfile=function(a,d,f){var g=b.defer(),j=d.id,k=d.get("profile"),l=a.user.objectId,m=new c,n=new i,o=new e.ACL,p=h.createHash([k.id,a.objectId].sort().join(""));return m.id=a.objectId,o.setReadAccess(j,!0),o.setWriteAccess(j,!0),o.setReadAccess(l,!0),o.setWriteAccess(l,!0),n.setACL(o),n.set("sender",k),n.set("receiver",m),n.set("profileIdsHash",p),n.set("requestStatus","accepted"),f&&n.set("requestStatus","pending"),n.save({success:function(){g.resolve()},error:function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}}),g.promise},this.acceptConnectionRequest=function(a){function c(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}var d=b.defer(),f=new e.Query(i);return f.get(a).then(function(a){a.set("requestStatus","accepted"),a.save().then(function(){d.resolve()},c)},c),d.promise},this.checkIfConnectionExists=function(a){var c=b.defer(),d=new e.Query(i),f=h.createHash(a.sort().join(""));return d.equalTo("profileIdsHash",f),d.find({success:function(a){return a.length?void c.resolve(!0):c.resolve(!1)},error:function(a){console.error("Parse Error: ",a),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.getConnectionsForDisplay=function(a){return k(a,!1)},this.getConnectionsForEdit=function(a){return k(a,!0)},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)
},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)a[c].get("profile")&&b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(c){var d,h=b.defer(),i=e.User.current()||{},j=new e.Query(e.Role),k=a.profilesCacheKey;return g(function(){d=f.getObject(k,[]),h.notify(d)},0),j.equalTo("name",c),j.find().then(function(a){if(a.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void h.reject({message:"Something went wrong, please contact system admin."});var b=a[0].relation(c+"s"),d=b.query();i.id&&d.notEqualTo(c,i),d.include("profile"),d.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));f.setObject(k,b),b=f.getObject(k,[]),h.resolve(b)},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),h.reject({message:"Please try again in a few moments, or contact support."})}),h.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}return this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(a){var c,d=b.defer(),h=e.User.current()||{},i=new e.Query(e.Role),j=profilesCacheKey;return g(function(){c=f.getObject(j,[]),d.notify(c)},0),i.equalTo("name",a),i.find().then(function(b){if(b.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void d.reject({message:"Something went wrong, please contact system admin."});var c=b[0].relation(a+"s"),e=c.query();h.id&&e.notEqualTo(a,h),e.include("profile"),e.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));f.setObject(j,b),b=f.getObject(j,[]),d.resolve(b)},function(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}),d.promise},this}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("tmProfiles",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(a){var c,d=b.defer(),h=e.User.current()||{},i=new e.Query(e.Role),j=profilesCacheKey;return g(function(){c=f.getObject(j,[]),d.notify(c)},0),i.equalTo("name",a),i.find().then(function(b){if(b.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void d.reject({message:"Something went wrong, please contact system admin."});var c=b[0].relation(a+"s"),e=c.query();h.id&&e.notEqualTo(a,h),e.include("profile"),e.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));f.setObject(j,b),b=f.getObject(j,[]),d.resolve(b)},function(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}),d.promise}}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).provider("Parse",function(){var a={profileCacheKey:"User/Profile",profileEditCacheKey:"User/Profile/Edit",profilesCacheKey:"User/Profiles"};return this.configure=function(b){angular.extend(a,b)},this.$get=["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(b,c,d,e,f,g,h){function i(d,h){var i,j,k,l=b.defer(),m=new e.Query(c),n=a.profileCacheKey;return h&&(n=a.profileEditCacheKey),g(function(){k=f.getObject(n),l.notify(k)},0),m.get(d,{success:function(a){j=a.getNgModel(),h&&(j=a.getNgFormModel()),f.setObject(n,j),i=f.getObject(n),l.resolve(i)},error:function(a,b){console.error("Parse Error: ",b),l.reject({message:"Please try again in a few moments, or contact support."})}}),l.promise}this.getProfileByIdForEditing=function(a){return i(a,!0)},this.getProfileByIdForDisplay=function(a){return i(a,!1)},this.updateProfile=function(d){var e=b.defer(),g=new c(d,{ngModel:!0,resetOpsQueue:!1}),h=a.profileEditCacheKey;return g.save(null,{success:function(a){f.setObject(h,a.getNgFormModel()),a=f.getObject(h),e.resolve(a)},error:function(a,b){console.error("Parse Error: ",b),e.reject({message:"Please try again in a few moments, or contact support."})}}),e.promise},this.followProfile=function(a,f){a=new c(a,{ngModel:!0,resetOpsQueue:!1});var g=b.defer(),i=new d,j=new e.ACL,k=f.get("profile"),l=h.createHash([a.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",a),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){g.resolve()},function(a){console.error("Parse Error: ",a),g.reject({message:"Please try again in a few moments, or contact support."})}),g.promise},this.unfollowProfile=function(a){var c=b.defer(),f=new e.Query(d),g=h.createHash(a.sort().join(""));return f.equalTo("profileIdsHash",g),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}})}if(!a.length)return console.error("No Parse Follow object found."),void c.reject({message:"Please contact support"});for(var d=0;d<a.length;d++)b(a[d]),d===a.length-1&&c.resolve()},error:function(a,b){console.error("Parse Error: ",b),c.reject({message:"Please try again in a few moments, or contact support."})}}),c.promise},this.checkIfFollowExists=function(a){var c,f=b.defer(),g=new e.Query(d);return c=h.createHash(a.sort().join("")),g.equalTo("profileIdsHash",c),g.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){console.error("Parse Error: ",a),f.reject({message:"Please try again in a few moments, or contact support."})}}),f.promise},this.getNeighbouringRoleSpecificProfiles=function(a){var c,d=b.defer(),h=e.User.current()||{},i=new e.Query(e.Role),j=profilesCacheKey;return g(function(){c=f.getObject(j,[]),d.notify(c)},0),i.equalTo("name",a),i.find().then(function(b){if(b.length>1)return console.error("Roles Error: There are duplicate roles in the database."),void d.reject({message:"Something went wrong, please contact system admin."});var c=b[0].relation(a+"s"),e=c.query();h.id&&e.notEqualTo(a,h),e.include("profile"),e.find().then(function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].get("profile"));f.setObject(j,b),b=f.getObject(j,[]),d.resolve(b)},function(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})})},function(a){console.error("Parse Error: ",a),d.reject({message:"Please try again in a few moments, or contact support."})}),d.promise}}],this}),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")
}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(e,f){e=new b(e,{ngModel:!0,resetOpsQueue:!1});var h=a.defer(),i=new c,j=new d.ACL,k=f.get("profile"),l=g.createHash([e.id,k.id].sort().join(""));return i.set("follower",k),i.set("following",e),i.set("profileIdsHash",l),j.setPublicReadAccess(!0),j.setWriteAccess(f,!0),i.setACL(j),i.save().then(function(){h.resolve()},function(a){h.reject(a)}),h.promise},this.unfollowProfile=function(b){var e=a.defer(),f=new d.Query(c),h=g.createHash(b.sort().join(""));return f.equalTo("profileIdsHash",h),f.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){e.reject(b)}})}if(!a.length)return e.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&e.resolve()},error:function(a,b){e.reject(b)}}),e.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(b,e){var f=a.defer(),h=new c,i=new d.ACL,j=e.get("profile"),k=g.createHash([b.id,j.id].sort().join(""));return h.set("follower",j),h.set("following",b),h.set("profileIdsHash",k),i.setPublicReadAccess(!0),i.setWriteAccess(e,!0),h.setACL(i),h.save().then(function(){f.resolve()},function(a,b){f.reject(b)}),f.promise},this.unfollowProfile=function(b){var e,f=a.defer(),h=new d.Query(c);return e=e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){f.reject(b)}})}if(!a.length)return f.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&f.resolve()},error:function(a,b){f.reject(b)}}),f.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(b,e){var f=a.defer(),h=new c,i=new d.ACL,j=e.get("profile"),k=g.createHash([b.id,j.id].sort().join(""));return h.set("follower",j),h.set("following",b),h.set("profileIdsHash",k),i.setPublicReadAccess(!0),i.setWriteAccess(e,!0),h.setACL(i),h.save().then(function(){f.resolve()},function(a,b){f.reject(b)}),f.promise},this.unfollowProfile=function(b){var e,f=a.defer(),h=new d.Query(c);return e=e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){f.reject(b)}})}if(!a.length)return f.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&f.resolve()},error:function(a,b){f.reject(b)}}),f.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){function h(c,g){var h,i=a.defer(),j=new d.Query(b),k="profile:display:"+c;return g&&(k="profile:edit:"+c),f(function(){var a=e.getObject(k);i.notify(a)},0),j.get(c,{success:function(a){var b=a.getNgModel();g&&(b=a.getNgFormModel()),e.setObject(k,b),h=e.getObject(k),i.resolve(h)},error:function(a,b){i.reject(b)}}),i.promise}this.getProfileByIdForEditing=function(a){return h(a,!0)},this.getProfileByIdForDisplay=function(a){return h(a,!1)},this.updateProfile=function(c){var d=a.defer(),f=new b(c,{ngModel:!0,resetOpsQueue:!1});return f.save(null,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(b,e){var f=a.defer(),h=new c,i=new d.ACL,j=e.get("profile"),k=g.createHash([b.id,j.id].sort().join(""));return h.set("follower",j),h.set("following",b),h.set("profileIdsHash",k),i.setPublicReadAccess(!0),i.setWriteAccess(e,!0),h.setACL(i),h.save().then(function(){f.resolve()},function(a,b){f.reject(b)}),f.promise},this.unfollowProfile=function(b){var e,f=a.defer(),h=new d.Query(c);return e=e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){f.reject(b)}})}if(!a.length)return f.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&f.resolve()},error:function(a,b){f.reject(b)}}),f.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){this.getProfileById=function(c,g){var h,i=a.defer(),j=new d.Query(b);return f(function(){var a=e.getObject(c);i.notify(a)},0),j.get(c,{success:function(a){return e.setObject(c,a),h=e.getObject(c),g?i.resolve({ngProfile:h,parseProfile:a}):void i.resolve(h)},error:function(a,b){null===b&&i.reject({message:"Could not find profile, please contact system admin."}),i.reject(b)}}),i.promise},this.updateProfile=function(c){var d=a.defer(),f=new b;return c.skills&&(c.skills=c.skills[0].split(",")),f.save(c,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(b,e){var f=a.defer(),h=new c,i=new d.ACL,j=e.get("profile"),k=g.createHash([b.id,j.id].sort().join(""));return h.set("follower",j),h.set("following",b),h.set("profileIdsHash",k),i.setPublicReadAccess(!0),i.setWriteAccess(e,!0),h.setACL(i),h.save().then(function(){f.resolve()},function(a,b){f.reject(b)}),f.promise},this.unfollowProfile=function(b){var e,f=a.defer(),h=new d.Query(c);return e=e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){f.reject(b)}})}if(!a.length)return f.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&f.resolve()},error:function(a,b){f.reject(b)}}),f.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){this.getProfileById=function(c,g){var h,i=a.defer(),j=new d.Query(b);return f(function(){var a=e.getObject(c);i.notify(a)},0),j.get(c,{success:function(a){return e.setObject(c,a),h=e.getObject(c),g?i.resolve({ngProfile:h,parseProfile:a}):void i.resolve(h)},error:function(a,b){null===b&&i.reject({message:"Could not find profile, please contact system admin."}),i.reject(b)}}),i.promise},this.updateProfile=function(c){var d=a.defer(),f=new b;return c.skills&&(c.skills=c.skills[0].split(",")),f.save(c,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(b,e){var f=a.defer(),h=new c,i=new d.ACL,j=e.get("profile"),k=g.createHash([b.id,j.id].sort().join(""));return h.set("follower",j),h.set("following",b),h.set("profileIdsHash",k),i.setPublicReadAccess(!0),i.setWriteAccess(e,!0),h.setACL(i),h.save().then(function(){f.resolve()},function(a,b){f.reject(b)}),f.promise},this.unfollowProfile=function(b){var e,f=a.defer(),h=new d.Query(c);return e=e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){f.reject(b)}})}if(!a.length)return f.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&f.resolve()},error:function(a,b){f.reject(b)}}),f.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]),angular.module("tm.parseProfiles",["angular-md5","tm.parse","tm.localstorage"]).factory("Profile",["Parse",function(a){return a.Object.extend("Profile")}]).factory("Follow",["Parse",function(a){return a.Object.extend("Follow")}]).service("tmProfiles",["$q","Profile","Follow","Parse","tmLocalStorage","$timeout","md5",function(a,b,c,d,e,f,g){this.getProfileById=function(c,g){var h,i=a.defer(),j=new d.Query(b);return f(function(){var a=e.getObject(c);i.notify(a)},0),j.get(c,{success:function(a){return e.setObject(c,a),h=e.getObject(c),g?i.resolve({ngProfile:h,parseProfile:a}):void i.resolve(h)},error:function(a,b){null===b&&i.reject({message:"Could not find profile, please contact system admin."}),i.reject(b)}}),i.promise},this.updateProfile=function(c){var d=a.defer(),f=new b;return c.skills&&(c.skills=c.skills[0].split(",")),f.save(c,{success:function(a){e.setObject(a.id,a),a=e.getObject(a.id),d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise},this.followProfile=function(b,e){var f=a.defer(),h=new c,i=new d.ACL,j=e.get("profile"),k=g.createHash([b.id,j.id].sort().join(""));return h.set("follower",j),h.set("following",b),h.set("profileIdsHash",k),i.setPublicReadAccess(!0),i.setWriteAccess(e,!0),h.setACL(i),h.save().then(function(){f.resolve()},function(a,b){f.reject(b)}),f.promise},this.unfollowProfile=function(b){var e,f=a.defer(),h=new d.Query(c);return e=e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){function b(a){a.destroy({success:function(){},error:function(a,b){f.reject(b)}})}if(!a.length)return f.reject("Something went wrong, please contact system admin");for(var c=0;c<a.length;c++)b(a[c]),c===a.length-1&&f.resolve()},error:function(a,b){f.reject(b)}}),f.promise},this.checkIfFollowExists=function(b){var e,f=a.defer(),h=new d.Query(c);return e=g.createHash(b.sort().join("")),h.equalTo("profileIdsHash",e),h.find({success:function(a){return a.length?void f.resolve(!0):f.resolve(!1)},error:function(a){f.reject(a)}}),f.promise},this.getNeighbourUserProfiles=function(b){var c=a.defer(),g=new d.Query(d.Role);return f(function(){var a=e.getObject("profiles");c.notify(a)},0),g.equalTo("name","user"),g.find().then(function(a){if(a.length>1)return void c.reject({message:"Something went wrong, please contact system admin."});var d=a[0].relation("users"),f=d.query();f.notEqualTo("users",b),f.include("profile"),f.find().then(function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].get("profile"));e.setObject("profiles",b),b=e.getObject("profiles"),c.resolve(b)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}}]);